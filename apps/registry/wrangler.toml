main = "./src/index.ts"
compatibility_date = "2022-11-11"
account_id = "274f86c6dcfbb77c09e49e86d101c753"

logpush = true
workers_dev = true
node_compat = true
minify = true
usage_model = "unbound"

[[migrations]]
tag = "v1"
new_classes = [
    "TokenRegistryDO",
    "ConfigurationRegistryDO",
    "ExchangeRegistryDO",
    "OracleRegistryDO",
]

[[migrations]]
tag = "v2"
new_classes = [
    "VaultRegistryDO"
]

[[migrations]]
tag = "v3"
new_classes = [
    "YieldRegistryDO"
]

[[migrations]]
tag = "v4"
deleted_classes = [
    "YieldRegistryDO"
]

[[migrations]]
tag = "v5"
deleted_classes = [
    "ExchangeRegistryDO"
]

[[migrations]]
tag = "v6"
new_classes = [
    "AccountRegistryDO"
]

[[migrations]]
tag = "v7"
deleted_classes = [
    "AccountRegistryDO"
]

[[migrations]]
tag = "v8"
deleted_classes = [
    "OracleRegistryDO"
]

[env.dev]
name = "registry-dev"

[env.dev.vars]
NX_ENV = 'dev'
# This is version that defines the durable object to retreive, increment it to reset
# the durable object to a clean version
VERSION = 'v8'
NX_DATA_URL = 'https://data-dev.notional.finance'
SUPPORTED_NETWORKS = [ 'arbitrum', 'all' ]

[env.dev.durable_objects]
bindings = [
  { name = "TOKEN_REGISTRY_DO", class_name = "TokenRegistryDO" },
  { name = "CONFIGURATION_REGISTRY_DO", class_name = "ConfigurationRegistryDO" },
  { name = "VAULT_REGISTRY_DO", class_name = "VaultRegistryDO" },
]

[env.prod]
name = "registry"

[env.prod.vars]
NX_ENV = 'prod'
VERSION = 'v8'
NX_DATA_URL = 'https://data.notional.finance'
SUPPORTED_NETWORKS = [ 'arbitrum', 'all' ]

[env.prod.durable_objects]
bindings = [
  { name = "TOKEN_REGISTRY_DO", class_name = "TokenRegistryDO" },
  { name = "CONFIGURATION_REGISTRY_DO", class_name = "ConfigurationRegistryDO" },
  { name = "VAULT_REGISTRY_DO", class_name = "VaultRegistryDO" },
]